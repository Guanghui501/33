<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>材料详情 - Nemesis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.1/3Dmol-min.js"></script>
    <style>
        /* 原有样式保留 */
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            max-width: 1200px;
            margin: 20px auto;
            gap: 20px;
        }
        .info {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            font-size: 18px;
            word-break: break-word;
            padding: 20px;
            box-sizing: border-box;
        }
        .viewer-container {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
        }
        #viewer {
            width: 100%;
            height: 500px; /* 减少高度为原子标签腾出空间 */
            border: 1px solid #ccc;
            position: relative;
        }
        /* 新增原子标签样式 */
        .atom-labels {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .atom-label {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 14px;
        }
        /* 其他原有样式保留 */
    </style>
</head>
<body>
    <div class="container">
        <div class="info">
            <!-- 原有信息区保持不变 -->
        </div>

        <div class="viewer-container">
            <div id="viewer">
                <div id="viewer-message">加载结构中...</div>
            </div>
            <!-- 新增原子标签展示区 -->
            <div class="atom-labels" id="atom-labels">
                <strong>组成元素：</strong>
                <!-- 原子标签将动态插入到这里 -->
            </div>
        </div>
    </div>

    <script>
    // 在数据加载部分添加以下代码
    function displayAtomLabels(symbols) {
        const labelContainer = document.getElementById('atom-labels');
        const uniqueElements = [...new Set(symbols)]; // 去重获取唯一元素
        
        uniqueElements.forEach(element => {
            const count = symbols.filter(sym => sym === element).length;
            const label = document.createElement('span');
            label.className = 'atom-label';
            label.textContent = `${element}${count > 1 ? `₅` : ''}`; // 使用下标显示数量
            labelContainer.appendChild(label);
        });
    }

    // 在数据加载成功后调用
    fetch('db.json')
        .then(response => response.json())
        .then(data => {
            const material = data[id];
            // ...原有数据加载逻辑...
            
            // 添加元素标签显示
            if (material.symbols) {
                displayAtomLabels(material.symbols);
            }

            // 移除原有的addAtomLabels调用
            try {
                currentCIF = generateCIF(material);
                viewer = $3Dmol.createViewer(document.getElementById("viewer"), { 
                    backgroundColor: "white",
                    defaultZoom: 1.0
                });
                viewer.addModel(currentCIF, "cif");
                
                // 仅保留基本渲染
                renderAtomsAndBonds();
                addUnitCell();
                
                // ...其他原有逻辑...
            } catch (err) {
                // ...错误处理...
            }
        });

    // 移除原有的addAtomLabels函数
    </script>
</body>
</html>
